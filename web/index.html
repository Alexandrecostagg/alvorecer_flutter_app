<!DOCTYPE html>
<html>
<head>
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="App Alvorecer">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="alvorecer_app">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>Alvorecer App</title>
  <link rel="manifest" href="manifest.json">

  <script>
    // The value below is injected by flutter build, do not touch.
    var serviceWorkerVersion = null;
  </script>

  <!-- CARREGAMENTO DOS DADOS B√çBLICOS PRIMEIRO -->
  <script src="js_or_arquivos_davi.js"></script>
  
  <!-- Carregando script do m√≥dulo da B√≠blia DEPOIS DOS DADOS -->
  <script src="BibleManager.js"></script>

  <!-- This script adds the flutter initialization JS code -->
  <script src="flutter.js"></script>
  
  <script>
    // Configura√ß√£o de debug para visualizar erros JavaScript
    window.onerror = function(message, source, lineno, colno, error) {
      console.error('Erro JavaScript:', message, 'em', source, 'linha', lineno);
      document.getElementById('loading-error').textContent = message;
      document.getElementById('loading-error').style.display = 'block';
      return false;
    };

    // Fun√ß√µes globais para comunica√ß√£o com Flutter
    function getBibleBooks() {
      try {
        if (typeof BibliaData !== 'undefined') {
          return JSON.stringify(Object.keys(BibliaData.dados));
        }
        return JSON.stringify(['genesis']);
      } catch (e) {
        console.error('Erro em getBibleBooks:', e);
        return JSON.stringify([]);
      }
    }

    function getBibleChapters(book) {
      try {
        if (typeof BibliaData !== 'undefined' && BibliaData.dados[book.toLowerCase()]) {
          return JSON.stringify(Object.keys(BibliaData.dados[book.toLowerCase()]).map(Number));
        }
        return JSON.stringify([1, 2, 3, 4, 5]);
      } catch (e) {
        console.error('Erro em getBibleChapters:', e);
        return JSON.stringify([]);
      }
    }

    function getBibleVerses(book, chapter) {
      try {
        if (typeof window.bibleManager !== 'undefined') {
          return window.bibleManager.loadChapter(book, chapter)
            .then(data => JSON.stringify(data))
            .catch(error => {
              console.error('Erro ao carregar cap√≠tulo:', error);
              return JSON.stringify({
                book: book,
                chapter: parseInt(chapter),
                verses: {},
                version: 'Almeida Revista e Corrigida',
                error: error.message
              });
            });
        }
        
        // Fallback com dados est√°ticos
        const staticData = {
          book: book,
          chapter: parseInt(chapter),
          verses: {
            1: "Este √© o livro das gera√ß√µes de Ad√£o. No dia em que Deus criou o homem, √† semelhan√ßa de Deus o fez.",
            2: "Homem e mulher os criou; e os aben√ßoou e chamou o seu nome Ad√£o, no dia em que foram criados."
          },
          version: 'Almeida Revista e Corrigida'
        };
        
        return Promise.resolve(JSON.stringify(staticData));
      } catch (e) {
        console.error('Erro em getBibleVerses:', e);
        return Promise.resolve(JSON.stringify({
          book: book,
          chapter: parseInt(chapter),
          verses: {},
          version: 'Almeida Revista e Corrigida',
          error: e.message
        }));
      }
    }

    function searchBible(query) {
      try {
        if (typeof window.bibleManager !== 'undefined') {
          return window.bibleManager.searchVerses(query)
            .then(results => JSON.stringify(results))
            .catch(error => {
              console.error('Erro na busca:', error);
              return JSON.stringify([]);
            });
        }
        
        // Fallback de busca
        return Promise.resolve(JSON.stringify([]));
      } catch (e) {
        console.error('Erro em searchBible:', e);
        return Promise.resolve(JSON.stringify([]));
      }
    }

    window.addEventListener('DOMContentLoaded', function() {
      console.log('DOM carregado, verificando BibleManager...');
      
      // Aguardar um pouco para os scripts carregarem
      setTimeout(() => {
        // Verificar se o BibliaData est√° dispon√≠vel
        if (typeof BibliaData !== 'undefined') {
          console.log('‚úÖ BibliaData est√° dispon√≠vel!');
        } else {
          console.error('‚ùå BibliaData n√£o est√° dispon√≠vel!');
        }
        
        // Verificar se o BibleManager est√° dispon√≠vel
        if (typeof window.bibleManager !== 'undefined') {
          console.log('‚úÖ BibleManager est√° dispon√≠vel!');
          // Inicializar o BibleManager
          window.bibleManager.initialize().then(success => {
            if (success) {
              console.log('‚úÖ BibleManager inicializado com sucesso!');
            } else {
              console.error('‚ùå Falha ao inicializar BibleManager');
            }
          });
        } else {
          console.error('‚ùå BibleManager n√£o est√° dispon√≠vel!');
        }
        
        // Teste adicional para verificar as fun√ß√µes globais
        console.log('üîç Verificando fun√ß√µes globais:');
        console.log('- getBibleBooks:', typeof getBibleBooks === 'function');
        console.log('- getBibleChapters:', typeof getBibleChapters === 'function');
        console.log('- getBibleVerses:', typeof getBibleVerses === 'function');
        console.log('- searchBible:', typeof searchBible === 'function');
      }, 100);
    });

    // Tornar as fun√ß√µes globalmente acess√≠veis
    window.getBibleBooks = getBibleBooks;
    window.getBibleChapters = getBibleChapters;
    window.getBibleVerses = getBibleVerses;
    window.searchBible = searchBible;
  </script>
</head>
<body>
  <div id="loading" style="display: flex; justify-content: center; align-items: center; height: 100vh; flex-direction: column; font-family: Arial, sans-serif;">
    <img src="favicon.png" alt="Alvorecer" width="72" height="72" style="margin-bottom: 20px;">
    <h2 style="color: #333; margin: 0;">Alvorecer</h2>
    <p style="color: #666; margin: 10px 0;">Carregando Aplicativo B√≠blico...</p>
    <div style="width: 50px; height: 4px; background: #e0e0e0; border-radius: 2px; overflow: hidden; margin: 20px 0;">
      <div style="width: 100%; height: 100%; background: linear-gradient(90deg, #4CAF50, #45a049); animation: loading 2s infinite;"></div>
    </div>
    <div id="loading-error" style="color: #f44336; margin-top: 20px; display: none; text-align: center; max-width: 400px;"></div>
  </div>

  <style>
    @keyframes loading {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
  </style>

  <script>
    window.addEventListener('load', function(ev) {
      console.log('üöÄ P√°gina totalmente carregada, inicializando Flutter...');
      
      // Download main.dart.js
      _flutter.loader.loadEntrypoint({
        serviceWorker: {
          serviceWorkerVersion: serviceWorkerVersion,
        },
        onEntrypointLoaded: function(engineInitializer) {
          console.log('üîß Flutter engine inicializado');
          engineInitializer.initializeEngine().then(function(appRunner) {
            console.log('üì± Flutter app inicializando');
            // Oculta a tela de loading
            document.getElementById('loading').style.display = 'none';
            appRunner.runApp();
            console.log('‚úÖ Flutter app iniciado com sucesso!');
          }).catch(function(error) {
            console.error('‚ùå Erro ao inicializar Flutter engine:', error);
            document.getElementById('loading-error').innerHTML = 
              '<strong>Erro ao inicializar o aplicativo:</strong><br>' + 
              error.message + '<br><br>' +
              '<small>Verifique o console do navegador para mais detalhes.</small>';
            document.getElementById('loading-error').style.display = 'block';
          });
        }
      });
    });
  </script>
</body>
</html>